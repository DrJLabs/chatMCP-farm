# Story 4.3: Filesystem MCP Runbook & Validation Docs

## Status
Approved

## Story
**As a** platform engineer responsible for MCP operations,
**I want** comprehensive runbooks and validation guides for the filesystem MCP bridge,
**so that** operators can bring the service online, verify it, and manage security toggles without rediscovering prior story context.

## Acceptance Criteria
1. `docs/runbooks/filesystem-mcp.md` documents prerequisites, environment variables, and the end-to-end bring-up flow for the filesystem MCP bridge using `scripts/compose.sh --profile filesystem-mcp`, including references to `Bridge.Dockerfile` outputs and `.env` expectations. [Source: docs/bmad/focused-epics/filesystem-mcp/epic.md#enhancement-details] [Source: docs/runbooks/compose-and-docs.md#aggregated-compose-workflow] [Source: docs/stories/4.2.filesystem-mcp-compose-profile.md#acceptance-criteria]
2. The runbook captures the security posture for `FS_ALLOWED`, `ALLOW_WRITE`, and `ENABLE_ROOTS`, outlining approval requirements, default read-only behaviour, and failure-handling guidance before toggling writes. [Source: docs/bmad/focused-epics/filesystem-mcp/epic.md#risk-mitigation] [Source: docs/stories/4.1.filesystem-mcp-bridge-container.md#dev-notes]
3. Validation steps in the runbook enumerate compose dry-run checks, bridge smoke tests (`scripts/filesystem-mcp-bridge-smoke.sh`), and log verification showing port 12010 plus allowed roots, with guidance on capturing evidence for Dev Notes and QA artifacts. [Source: scripts/filesystem-mcp-bridge-smoke.sh] [Source: docs/stories/4.2.filesystem-mcp-compose-profile.md#testing] [Source: docs/architecture.md#9-testing-strategy]
4. Cross-references exist in `docs/runbooks/compose-and-docs.md` and `docs/bootstrap-checklist.md` pointing operators to the new filesystem MCP runbook when enabling the profile, keeping operational documentation consistent. [Source: docs/runbooks/compose-and-docs.md#aggregated-compose-workflow] [Source: docs/bootstrap-checklist.md#bootstrap-steps]

## Tasks / Subtasks
- [x] Draft `docs/runbooks/filesystem-mcp.md` with sections for prerequisites, configuration (`.env` variables), bring-up, validation, and teardown covering the filesystem profile (AC: 1,3). [Source: docs/bmad/focused-epics/filesystem-mcp/epic.md#success-criteria] [Source: docs/runbooks/compose-and-docs.md#aggregated-compose-workflow]
  - [x] Include explicit references to `services/filesystem-mcp/Bridge.Dockerfile` outputs and compose profile expectations derived from Stories 4.1 and 4.2. (AC: 1) [Source: docs/stories/4.1.filesystem-mcp-bridge-container.md#acceptance-criteria] [Source: docs/stories/4.2.filesystem-mcp-compose-profile.md#dev-notes]
- [x] Document security guardrails for filesystem roots and write toggles, including approval workflow and failure-handling scenarios. (AC: 2) [Source: docs/bmad/focused-epics/filesystem-mcp/epic.md#risk-mitigation]
- [x] Capture validation procedures: compose config dry-run, bridge smoke script, log inspection for SSE port and allowed roots, and evidence logging expectations. (AC: 3) [Source: scripts/filesystem-mcp-bridge-smoke.sh] [Source: docs/stories/4.2.filesystem-mcp-compose-profile.md#testing]
- [x] Update `docs/runbooks/compose-and-docs.md` and `docs/bootstrap-checklist.md` to reference the filesystem runbook and highlight opt-in profile usage. (AC: 4) [Source: docs/runbooks/compose-and-docs.md#aggregated-compose-workflow] [Source: docs/bootstrap-checklist.md#bootstrap-steps]
- [x] Verify project structure alignment so new documentation lives under `docs/runbooks/` and follows existing formatting conventions. (AC: 1,4) [Source: docs/architecture/source-tree.md#source-tree-reference]

## Dev Notes
- **Previous Story Insights:** Story 4.2 confirmed compose profile activation through `scripts/compose.sh --profile filesystem-mcp` and documented host bind defaults plus write toggle warnings; reuse those expectations in the runbook. [Source: docs/stories/4.2.filesystem-mcp-compose-profile.md#dev-notes]
- **Data Models:** No additional persistence is introduced; the bridge streams filesystem content and relies solely on mounted directories. [Source: docs/architecture.md#6-data--integrations]
- **API Specifications:** Operators interact with the SSE bridge on port 12010 via `mcp-proxy`; documentation should link to manifest and smoke validation rather than new APIs. [Source: docs/bmad/focused-epics/filesystem-mcp/epic.md#success-criteria]
- **Component Specifications:** Place runbook under `docs/runbooks/` and cross-link compose wrapper guidance so operators follow the shared automation pattern. [Source: docs/architecture/source-tree.md#source-tree-reference] [Source: docs/runbooks/compose-and-docs.md#aggregated-compose-workflow]
- **File Locations:** Reference `services/filesystem-mcp/Bridge.Dockerfile`, `services/filesystem-mcp/compose.yml`, and `services/filesystem-mcp/.env.example` when describing bring-up. [Source: docs/architecture/source-tree.md#source-tree-reference]
- **Testing Requirements:** Emphasize compose config checks, smoke script execution, and evidence capture consistent with the testing strategy. [Source: docs/architecture.md#9-testing-strategy] [Source: scripts/filesystem-mcp-bridge-smoke.sh]
- **Technical Constraints:** Keep `FS_ALLOWED` defaulting to `/projects:/VAULTS`, enforce read-only mounts, and require approvals before enabling writes to limit risk. [Source: docs/bmad/focused-epics/filesystem-mcp/epic.md#risk-mitigation]
- **Project Structure Notes:** Ensure the new runbook mirrors existing markdown conventions (title, purpose, steps) and does not modify root `docker-compose.yml`, keeping compose fragments opt-in. [Source: docs/architecture/source-tree.md#source-tree-reference]
- **No Additional Guidance:** Architecture shards do not introduce filesystem-specific UI or data components beyond the compose bridge; focus documentation on operations. [Source: docs/architecture/tech-stack.md#containerization]

## Testing
- `scripts/compose.sh --profile filesystem-mcp config` to verify documented bring-up commands and capture output examples for the runbook. [Source: docs/runbooks/compose-and-docs.md#aggregated-compose-workflow]
- `COMPOSE_PROFILES=filesystem-mcp scripts/compose.sh up --build` followed by `docker logs` on the bridge container to confirm port 12010 and allowed roots messaging. [Source: docs/stories/4.2.filesystem-mcp-compose-profile.md#testing]
- `scripts/filesystem-mcp-bridge-smoke.sh filesystem-mcp-bridge:local` to validate the smoke procedure described in the documentation. [Source: scripts/filesystem-mcp-bridge-smoke.sh]

## üî¨ Research & Validation Log
- 2025-09-25: Reviewed compose orchestration standards to ensure runbook steps mirror the shared wrapper workflow for opt-in profiles. [Source: docs/runbooks/compose-and-docs.md#aggregated-compose-workflow]
- 2025-09-25: Confirmed filesystem MCP risk posture around write toggles and root exposure that the runbook must reiterate before enabling overrides. [Source: docs/bmad/focused-epics/filesystem-mcp/epic.md#risk-mitigation]
- 2025-09-25: Verified smoke validation requirements so operators capture evidence when running `scripts/filesystem-mcp-bridge-smoke.sh` alongside port/log checks. [Source: scripts/filesystem-mcp-bridge-smoke.sh]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-09-25 | 0.1 | Draft created for filesystem MCP runbook documentation. | Scrum Master |

## QA Results
- Gate: PASS (2025-09-25) ‚Äì Filesystem runbook delivered; QA traceability, NFR, and review confirm acceptance criteria coverage.
- Risks: docs/qa/assessments/4.3-risk-20250925.md (monitor SEC-4.3-001 approval workflow).
- Test Design: docs/qa/assessments/4.3-test-design-20250925.md (executed doc reviews, static checks, reviewer smoke evidence).
- Traceability: docs/qa/assessments/4.3-trace-20250925.md; NFR: docs/qa/assessments/4.3-nfr-20250925.md; Review: docs/qa/assessments/4.3-review-20250925.md.

## PO Validation
- Decision: READY FOR DEV (2025-09-25) ‚Äì See docs/qa/assessments/4.3-po-validation-final-20250925.md for final approval; residual monitoring captured in risk recommendations.
- Key follow-ups: monitor SEC-4.3-001 during staging/production enablement and capture approval evidence per runbook.

## Dev Agent Record
### Agent Model Used
- GPT-5 (Codex CLI Dev Agent ‚ÄúJames‚Äù)

### Debug Log References
- Manual verification of `docs/runbooks/filesystem-mcp.md`
- Reviewed cross-links via `rg filesystem-mcp docs/runbooks docs/bootstrap-checklist.md`

### Completion Notes List
- Authored filesystem MCP runbook covering prerequisites, configuration, bring-up workflow, validation checklist, approval workflow, and troubleshooting guidance aligned with Stories 4.1/4.2.
- Updated compose and bootstrap runbooks to reference the new documentation so operators can find the runbook during activation.
- Captured QA, PO, and task updates in the story to reflect outstanding gate actions prior to deployment.

### File List
- docs/runbooks/filesystem-mcp.md
- docs/runbooks/compose-and-docs.md
- docs/bootstrap-checklist.md
- docs/qa/assessments/4.3-risk-20250925.md
- docs/qa/assessments/4.3-test-design-20250925.md
- docs/qa/assessments/4.3-po-validation-20250925.md
- docs/stories/4.3.filesystem-mcp-runbook.md
