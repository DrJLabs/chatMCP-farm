# Risk Profile: Story 3.1

Date: 2025-09-25
Reviewer: Quinn (Test Architect)

## Executive Summary
- Total Risks Identified: 5
- Critical Risks: 0
- High Risks: 2
- Medium Risks: 3
- Risk Score: 65/100

Story 3.1 replaces the bespoke GitHub MCP transport with an opt-in bridge that runs the `github-mcp-server` binary behind `mcp-proxy`. The largest exposure sits in preserving OAuth/session semantics through the proxy and keeping the supply-chain footprint of the new container provable. Medium risks concentrate on operational rollout, parity regression between upstream and fallback modes, and observability gaps if the bridge fails in production.

## High Risks Requiring Immediate Attention

### 1. SEC-3.1-001: Proxy drops or mutates auth/session headers
**Score:** 6 (High) — Probability: Medium (2), Impact: High (3)
- **Why it matters:** Missing `Authorization`, `mcp-session-id`, or `MCP-Protocol-Version` breaks Keycloak enforcement or session reuse, causing 401 loops or unauthenticated tool access.
- **Mitigation:** 
  - Add unit coverage for the proxy helper that asserts header propagation and protocol defaults.
  - Execute authenticated `/mcp` parity tests with upstream enabled to confirm headers reach `github-mcp-server`.
  - Instrument validation logs with forwarded header names for troubleshooting.

### 2. SEC-3.1-002: github-mcp-server/mcp-proxy supply-chain drift
**Score:** 6 (High) — Probability: Medium (2), Impact: High (3)
- **Why it matters:** Unpinned binary downloads or mismatched hashes allow malicious updates or a sudden build break, blocking the bridge or introducing compromised tooling.
- **Mitigation:**
  - Pin `github-mcp-server` release artefacts and `mcp-proxy` versions, publishing SHA256 sums in the Dockerfile/README.
  - Schedule a recurring upgrade check and document rollback to the last known-good version.
  - Capture version hashes (binary + proxy) in the Dev Agent Record during validation.

## Medium Risks To Monitor

### 3. OPS-3.1-003: Compose profile leaks into default stack
**Score:** 4 (Medium) — Probability: Medium (2), Impact: Medium (2)
- **Why it matters:** If the `github-mcp-bridge` service appears without the profile flag, operators might unknowingly run the proxy in environments lacking GitHub credentials.
- **Mitigation:**
  - Validate profile gating via `scripts/compose.sh config` in CI.
  - Document activation steps prominently in README and `.env.example`.
  - Add a smoke check that fails when the bridge runs without the profile enabled.

### 4. OPS-3.1-004: Upstream/local parity divergence
**Score:** 4 (Medium) — Probability: Medium (2), Impact: Medium (2)
- **Why it matters:** GitHub may roll out new toolsets only to the upstream server; operators expect identical behaviour when falling back to the local transport during incidents.
- **Mitigation:**
  - Record parity evidence (tool lists, manifest hashes) in the Dev Agent Record.
  - Track GitHub MCP release notes and log follow-ups when parity gaps appear.
  - Keep rollback documentation current so operators know what features disappear when upstream is disabled.

### 5. OBS-3.1-005: Limited observability for the bridge process
**Score:** 3 (Medium) — Probability: Low (1), Impact: High (3)
- **Why it matters:** Without explicit logs/metrics, diagnosing bridge crashes or GitHub rate-limit errors slows incident response.
- **Mitigation:**
  - Route bridge stdout/stderr into the existing logging stack and document the log path.
  - Expose readiness/liveness endpoints or shell health probes where possible.
  - Add follow-up to evaluate lightweight metrics (e.g., request counters) post-MVP.

## Risk Matrix

| Risk ID       | Description                                   | Probability | Impact | Score | Priority |
|---------------|-----------------------------------------------|-------------|--------|-------|----------|
| SEC-3.1-001   | Proxy drops/mutates auth or session headers    | Medium (2)  | High (3) | 6 | High |
| SEC-3.1-002   | github-mcp-server / mcp-proxy supply-chain drift | Medium (2)  | High (3) | 6 | High |
| OPS-3.1-003   | Compose profile leaks into default stack       | Medium (2)  | Medium (2) | 4 | Medium |
| OPS-3.1-004   | Upstream/local parity divergence               | Medium (2)  | Medium (2) | 4 | Medium |
| OBS-3.1-005   | Limited observability for bridge process       | Low (1)     | High (3) | 3 | Medium |

## Risk-Based Testing Strategy
- **Priority 1:** Execute header propagation unit/integration tests (SEC-3.1-001) and version pinning verification (SEC-3.1-002).
- **Priority 2:** Compose profile gating and fallback parity validation (OPS-3.1-003/004).
- **Priority 3:** Observability follow-ups, ensuring log paths recorded for operators (OBS-3.1-005).

## Risk Summary (Gate Snippet)
```yaml
risk_summary:
  totals:
    critical: 0
    high: 2
    medium: 3
    low: 0
  highest:
    id: SEC-3.1-001
    score: 6
    title: 'Proxy drops or mutates auth/session headers'
  recommendations:
    must_fix:
      - 'Land proxy header propagation unit/integration tests covering Authorization and session headers.'
      - 'Pin github-mcp-server and mcp-proxy versions with published sha256 sums before merge.'
    monitor:
      - 'Add compose profile gating guardrails in CI to prevent unintended bridge startup.'
      - 'Document parity validation cadence to catch upstream/local divergence.'
```

## Residual Risk & Follow-Ups
- Residual risk acceptable once P0 tests and version pinning complete; observability remains a trackable follow-up for post-MVP hardening.
- Trigger re-review when GitHub publishes new MCP toolsets or when bridge logs show repeated upstream failures.

## References
- docs/stories/3.1.github-mcp-bridge.md
- docs/stories/epic-github-mcp-bridge.md
- docs/architecture/tech-stack.md
- docs/oauth-keycloak.md
