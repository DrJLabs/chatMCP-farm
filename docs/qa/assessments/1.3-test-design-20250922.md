# Test Design: Story 1.3

Date: 2025-09-22
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 8
- Unit tests: 2 (25%)
- Integration tests: 4 (50%)
- E2E tests: 2 (25%)
- Priority distribution: P0: 4, P1: 3, P2: 1, P3: 0

## Test Scenarios by Acceptance Criteria

### AC1: Document opt-in compose workflow (`--profile`, `COMPOSE_PROFILES`, network prerequisites)

| ID             | Level       | Priority | Test                                                                 | Justification                                                                                      |
|----------------|-------------|----------|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| 1.3-INT-001    | Integration | P0       | Validate runbook instructions by running `scripts/compose.sh --profile mcp-test-server config` in CI dry-run. | Ensures documented CLI path actually isolates the service; directly mitigates TECH-001.            |
| 1.3-INT-002    | Integration | P1       | Verify CI job exporting `COMPOSE_PROFILES=mcp-test-server` starts only the targeted service.       | Confirms automation pathway works and surfaces missing network prerequisites early.               |

### AC2: Smoke workflow covering Accept header and `Mcp-Session-Id`

| ID             | Level       | Priority | Test                                                                 | Justification                                                                                      |
|----------------|-------------|----------|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| 1.3-UNIT-001   | Unit        | P0       | Assert smoke script sets `Accept: application/json, text/event-stream` and `MCP-Protocol-Version`. | Fast guard that encodes MCP spec headers; mitigates TECH-002.                                     |
| 1.3-INT-003    | Integration | P0       | Execute `scripts/healthcheck.sh` + `npm run smoke` and capture headers plus `Mcp-Session-Id`.      | Proves runtime integration against live service; verifies diagnostics output.                     |

### AC3: ChatGPT Developer Mode connector guidance

| ID             | Level       | Priority | Test                                                                 | Justification                                                                                      |
|----------------|-------------|----------|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| 1.3-E2E-001    | E2E         | P1       | Follow runbook to enable Developer Mode connector in staging and confirm DCR scope mapping.       | Validates instructions end-to-end while keeping secrets in `.keycloak-env`; mitigates BUS-001.    |
| 1.3-E2E-002    | E2E         | P1       | Validate documented `search`/`fetch` requirement by attempting connector enablement without tools and confirming warnings. | Ensures runbook captures platform expectation; triggers updates if behaviour changes.             |

### AC4: README / `.env.example` alignment with automation

| ID             | Level       | Priority | Test                                                                 | Justification                                                                                      |
|----------------|-------------|----------|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| 1.3-INT-004    | Integration | P1       | Cross-check README + `.env.example` entries align with Keycloak scope script parameters.          | Prevents operator misconfiguration and reinforces SEC-001 mitigation.                             |

### AC5: Workspace regression health (lint/build/test + spec assertions)

| ID             | Level       | Priority | Test                                                                 | Justification                                                                                      |
|----------------|-------------|----------|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| 1.3-UNIT-002   | Unit        | P0       | Unit test for helper that parses `Mcp-Session-Id`/`MCP-Protocol-Version` from responses.           | Guarantees parser accuracy before integration calls; mitigates TECH-002.                          |
| 1.3-INT-005    | Integration | P2       | Run `npm run lint|build|test --workspace mcp-test-server` and attach results to story QA evidence. | Confirms regression coverage remains intact with documentation updates.                           |

## Risk Coverage

- TECH-001: 1.3-INT-001, 1.3-INT-002
- SEC-001: 1.3-INT-004, 1.3-E2E-001 (security practices)
- TECH-002: 1.3-UNIT-001, 1.3-UNIT-002, 1.3-INT-003
- BUS-001: 1.3-E2E-001, 1.3-E2E-002
- OPS-001: 1.3-INT-005 (teardown verification included in regression evidence)

## Recommended Execution Order

1. P0 unit tests (1.3-UNIT-001, 1.3-UNIT-002)
2. P0/P1 integration smoke (1.3-INT-001, 1.3-INT-003, 1.3-INT-002)
3. P1 E2E connector validations (1.3-E2E-001, 1.3-E2E-002)
4. Remaining integration/doc checks (1.3-INT-004)
5. Regression verification (1.3-INT-005)

---

**Gate Summary Snippet**

```yaml
test_design:
  scenarios_total: 8
  by_level:
    unit: 2
    integration: 4
    e2e: 2
  by_priority:
    p0: 4
    p1: 3
    p2: 1
    p3: 0
  coverage_gaps: []
```

**Trace Hook**

```
Test design matrix: docs/qa/assessments/1.3-test-design-20250922.md
P0 tests identified: 4
```
