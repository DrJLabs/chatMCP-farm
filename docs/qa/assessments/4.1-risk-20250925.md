# Risk Profile: Story 4.1

Date: 2025-09-25 (updated)
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 3
- Critical Risks: 0
- High Risks: 0
- Risk Score: 91/100

## Critical Risks Requiring Immediate Attention

No critical (score 9) risks identified; highest severity is Medium (score 4).

## Risk Matrix

| Risk ID   | Description                                                                 | Probability | Impact | Score | Priority |
| --------- | --------------------------------------------------------------------------- | ----------- | ------ | ----- | -------- |
| SEC-001   | Misconfigured `FS_ALLOWED` exposes unintended host roots (e.g., `/etc`).     | Low (1)     | High (3) | 3   | Low |
| OPS-001   | Container launch fails when required host directories are absent/mis-mounted. | Medium (2) | Medium (2) | 4 | Medium |
| TECH-001  | Upstream `mcp-proxy` change breaks bridge startup semantics or CLI flags.    | Low (1)     | Medium (2) | 2 | Low |

## Risk Distribution

### By Category

- Security: 1 risks (0 critical)
- Operational: 1 risks (0 critical)
- Technical: 1 risks (0 critical)
- Performance: 0 risks (0 critical)
- Data: 0 risks (0 critical)
- Business: 0 risks (0 critical)

### By Component

- Entrypoint script: 1 risks
- Container image runtime: 1 risks
- Deployment configuration (volumes/env): 1 risks
- Other components: 0 risks

## Detailed Risk Register

### SEC-001 – Misconfigured `FS_ALLOWED` exposes unintended host roots
- **Category:** Security
- **Probability:** Low (entrypoint blocks empty and root paths; operator must deliberately override defaults)
- **Impact:** High (exposes sensitive host directories to MCP clients)
- **Affected Components:** Entrypoint script, bridge runtime
- **Detection:** Compose profile or env review
- **Mitigation Strategy:** Preventive
  - Guardrails now reject empty strings and `/` entries; defaults remain `/projects:/VAULTS`.
  - Dockerfile comments document approval workflow for enabling writes or expanding roots.
  - Smoke script validates guardrail behaviour in CI.
- **Testing Requirements:**
  - Integration check via `docker run --rm -e FS_ALLOWED=/projects:/VAULTS` to confirm only configured roots are passed to `rust-mcp-filesystem`.
  - Smoke script ensures empty `FS_ALLOWED` fails fast.
- **Residual Risk:** Low; manual overrides still require review before applying to production.

### OPS-001 – Container launch fails with missing host directories
- **Category:** Operational
- **Probability:** Medium (new hosts may lack `/VAULTS` or mount permissions)
- **Impact:** Medium (service unavailable; MCP clients lose filesystem proxy)
- **Affected Components:** Deployment configuration, container runtime
- **Detection:** Compose up / docker logs
- **Mitigation Strategy:** Preventive
  - Document prerequisite host paths and add bring-up checklist updates.
  - Recommend optional health check or start-up validation script to fail fast with actionable error message.
- **Testing Requirements:**
  - Integration test using `docker run` with invalid volume mounts to verify error handling messaging.
  - Operational playbook entry for verifying host directories exist before deployment.
- **Residual Risk:** Medium; depends on ops discipline.

- **Category:** Technical
- **Probability:** Low (image pins `mcp-proxy` 0.9.0 and smoke script asserts version string)
- **Impact:** Medium (bridge crashes or stops forwarding to SSE port)
- **Affected Components:** Container image runtime layer
- **Detection:** CI build logs; runtime smoke tests
- **Mitigation Strategy:** Preventive/Detective
  - Pin `mcp-proxy` version in Dockerfile and surface it via OCI label.
  - CI smoke script runs `mcp-proxy --version` against the image and fails if the expected version is absent.
- **Testing Requirements:**
  - Integration test or smoke script verifying version output.
  - Regression test to ensure SSE port binding remains 12010 by default.
- **Residual Risk:** Low after pinning and smoke coverage.

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests

- No critical risks; proceed to High risk coverage.

### Priority 2: High Risk Tests

- Validate entrypoint argument parsing for `FS_ALLOWED`, `ALLOW_WRITE`, and `ENABLE_ROOTS` combinations via unit or integration scripts.
- Confirm container rejects or logs when `FS_ALLOWED` includes forbidden roots.

### Priority 3: Medium/Low Risk Tests

- Operational smoke test to ensure startup failure message is clear when mounts missing.
- CI guard verifying pinned `mcp-proxy` build still runs the binary with expected flags.

## Risk Acceptance Criteria

### Must Fix Before Production

- SEC-001 must have safeguards (documentation + defaults) in place prior to enabling writes in any environment.

### Can Deploy with Mitigation

- OPS-001 acceptable with documented operational checklist.
- TECH-001 acceptable with version pinning and CI smoke tests.

### Accepted Risks

- None at this time.

## Monitoring Requirements

- Add logging/alerting when `rust-mcp-filesystem` receives `--allow-write` or `--enable-roots` to detect configuration drift.
- Monitor container restart counts to catch mount-related failures.
- Track `mcp-proxy` version via image label to simplify audits.

## Risk Review Triggers

- Upstream `rust-mcp-filesystem` or `mcp-proxy` release changes CLI contracts.
- Expansion beyond `/projects` and `/VAULTS` or enabling writes in shared environments.
- Infra changes altering mount paths or permissions.

## Risk-Based Recommendations

1. **Testing Priority** – Keep smoke script in CI to verify guardrails and version pin stay intact.
2. **Development Focus** – Maintain documentation for write enablement approvals.
3. **Deployment Strategy** – Require infrastructure checklist ensuring host directories exist and writes toggled deliberately.
4. **Monitoring Setup** – Capture metrics on bridge command-line args and container health endpoints post-deployment.

## Integration with Quality Gates

- Highest risk score is 4 (Medium) → Gate stance: PASS with monitoring for OPS-001.

```
Risk profile: qa.qaLocation/assessments/4.1-risk-20250925.md
```
