# Requirements Traceability Matrix

## Story: 2.1 – Upgrade MCP Test Server Dependency Stack

Date: 2025-09-24  
Analyst: Quinn (QA)

### Coverage Summary
- Total Requirements: 4
- Fully Covered: 3 (75%)
- Partially Covered: 1 (25%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1 – Pin upgraded dependencies and remove redundant Express 4 artifacts
- **Coverage:** Partial
- **Evidence / Tests:**
  - `services/mcp-test-server/package.json` + `package-lock.json` upgrades reviewed in GIT diff; branch `feat/express5-mcp-test-server`.
  - `npm run test --workspace mcp-test-server` (Vitest 3.2.4) confirms upgraded toolchain compiles.
  - `npm ls express --workspace mcp-test-server` shows only Express 5.1.0 under service scope.
  - `npm ls @types/express --workspace mcp-test-server` still reports `@types/express@^4` via shared `mcp-auth-kit`; remediation deferred to Story 2.4.  
  **Follow-up:** Track peer update in Story 2.4 to retire shared Express 4 type dependency.

#### AC2 – Express 5 middleware signatures compile and auth guard behaviour preserved
- **Coverage:** Full
- **Evidence / Tests:**
  - `npm run build --workspace mcp-test-server` (TypeScript strict build) passes with Express 5 types.
  - `services/mcp-test-server/test/accept-header.spec.ts` new case verifies 401 challenge when auth required.
  - `services/mcp-test-server/test/manifest.spec.ts` + `test/diagnostics.spec.ts` assure manifest/diagnostics behaviour unchanged.

#### AC3 – Vitest 3 migration succeeds and smoke/tests run via workspace + aggregate scripts
- **Coverage:** Full
- **Evidence / Tests:**
  - `npm run test --workspace mcp-test-server` (Vitest 3.2.4) + `npm run smoke --workspace mcp-test-server` (event-stream tolerant).
  - Root `npm run test` exercises workspaces after `scripts/cloud-test.sh` update.
  - `scripts/cloud-test.sh` diff ensures CI installs Vitest 3 + supertest 7.1.1 with consistent coverage config.

#### AC4 – Documentation/rollback guidance updated for Express 5 baseline
- **Coverage:** Full
- **Evidence / Tests:**
  - `services/mcp-test-server/README.md` “What ships in Story 2.1” + rollback section validated against completion notes.
  - Story completion notes capture pre-upgrade lockfile hash `36b95d8d77b0a2c2262ce66916b49c14b6ba3eded074520d26e503e82048a218` and README callout.
  - Manual check of `.env.example` confirms no additional updates required (no config drift introduced).

### Coverage Gaps
1. **AC1** – Shared `mcp-auth-kit` still drags `@types/express@4`. Severity: Medium (dependency hygiene).  
   *Recommendation:* Story 2.4 (auth kit upgrade) must bump peers to Express 5 and remove legacy type dependency; monitor `npm ls @types/express` in CI until addressed.

### Trace Gate Snippet
```yaml
trace:
  totals:
    requirements: 4
    full: 3
    partial: 1
    none: 0
  planning_ref: docs/qa/assessments/2.1-test-design-20250924.md
  uncovered:
    - AC1
  notes: docs/qa/assessments/2.1-trace-20250924.md
```

**Hook:** `Trace matrix: docs/qa/assessments/2.1-trace-20250924.md`
