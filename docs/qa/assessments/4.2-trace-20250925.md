# Requirements Traceability Matrix

## Story: 4.2 – Filesystem MCP Compose Profile

Date: 2025-09-25  
Analyst: Quinn (Test Architect)

### Coverage Summary
- Total Requirements: 5
- Fully Covered: 5 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1 – Compose profile builds Bridge.Dockerfile, attaches proxy network, and wires Traefik routing for fs-mcp host
- **Coverage:** Full
- **Evidence / Tests:**
  - `scripts/compose.sh --profile filesystem-mcp config` renders the `filesystem-mcp-bridge` service with `profiles: [filesystem-mcp]`, the shared `proxy` network, and Traefik router `Host(${MCP_PUBLIC_HOST:-fs-mcp.local})` targeting `${SSE_PORT}`. (4.2-INT-001)
  - `services/filesystem-mcp/compose.yml` checked into VCS matches the generated config, keeping the profile opt-in via scripts.

#### AC2 – Host mounts default to read-only `/projects` and `/VAULTS` while exposing explicit write toggles
- **Coverage:** Full
- **Evidence / Tests:**
  - `docker inspect chat-mcp-farm-filesystem-mcp-bridge-1 --format '{{ json .Mounts }}'` confirms both bind mounts use `"Mode":"ro","RW":false`. (4.2-INT-002)
  - Override exercise (`timeout 5 docker run … ALLOW_WRITE=true ENABLE_ROOTS=true`) logged warning banners and clean shutdown, demonstrating controlled escalation. (4.2-INT-006)

#### AC3 – Container env forwards FS_ALLOWED, SSE_PORT, ALLOW_WRITE, ENABLE_ROOTS from service `.env`
- **Coverage:** Full
- **Evidence / Tests:**
  - `COMPOSE_PROFILES=filesystem-mcp scripts/compose.sh exec filesystem-mcp-bridge env | grep -E 'FS_ALLOWED|ALLOW_WRITE|ENABLE_ROOTS|SSE_PORT'` shows runtime variables matching `.env` defaults. (4.2-INT-004)
  - `.env.example` documents the same variables with secure defaults and guidance for overrides.

#### AC4 – `.env.example` captures Keycloak/OIDC placeholders, host roots, and security guidance
- **Coverage:** Full
- **Evidence / Tests:**
  - `services/filesystem-mcp/.env.example` stores Keycloak realm/client placeholders, public host, host root paths, read-only toggles, and approval notes for enabling writes. (4.2-UNIT-002)
  - Documentation warns operators to log warning-banner evidence when enabling `ALLOW_WRITE` or `ENABLE_ROOTS`.

#### AC5 – Compose bring-up evidences SSE port, allowed roots, and smoke harness output
- **Coverage:** Full
- **Evidence / Tests:**
  - `COMPOSE_PROFILES=filesystem-mcp scripts/compose.sh up --build --detach` followed by `docker logs chat-mcp-farm-filesystem-mcp-bridge-1` shows startup announcing port `12010` and roots `/projects /VAULTS`. (4.2-E2E-001)
  - `scripts/filesystem-mcp-bridge-smoke.sh chat-mcp-farm-filesystem-mcp-bridge` validates `mcp-proxy 0.9.0`, guardrail rejection of empty `FS_ALLOWED`, and in-container socket connectivity. (4.2-E2E-002)
  - Teardown captured via `COMPOSE_PROFILES=filesystem-mcp scripts/compose.sh down --remove-orphans`.

### Coverage Gaps
- None.

### Trace Gate Snippet
```yaml
trace:
  totals:
    requirements: 5
    full: 5
    partial: 0
    none: 0
  planning_ref: docs/qa/assessments/4.2-test-design-20250925.md
  uncovered: []
  notes: docs/qa/assessments/4.2-trace-20250925.md
```

Trace matrix stored at docs/qa/assessments/4.2-trace-20250925.md
