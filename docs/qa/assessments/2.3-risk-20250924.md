# Risk Profile: Story 2.3 – Refresh Service Template for Express 5 Baseline

Date: 2025-09-24  
Assessor: Quinn (Test Architect)

## Overview
Story 2.3 re-baselines the service template so every newly scaffolded MCP service inherits the Express 5.1 + Vitest 3.2 stack, picks up the `postbump:test` helper workflow, and documents the bootstrap process. The work sits on the delivery path for all future services; gaps here ripple across the monorepo. This assessment emphasizes dependency alignment, bootstrap automation, coverage tooling performance, and retained security guardrails from `mcp-auth-kit`.

## Risk Matrix

| Risk ID | Category | Description | Probability | Impact | Score | Priority |
|---------|----------|-------------|-------------|--------|-------|----------|
| TECH-001 | Technical | Template dependency matrix drifts from Stories 2.1/2.2, leaving new services with mixed Express 4/5 trees or missing lint script parity | Medium (2) | High (3) | 6 | High |
| OPS-001 | Operational | Bootstrap workflow (`scripts/bootstrap.sh` + README guidance) fails to enforce lint/test/smoke/postbump execution, letting scaffolded services skip baseline validation | Medium (2) | Medium (2) | 4 | Medium |
| PERF-001 | Performance | Vitest 3.2 V8 coverage configuration increases runtime for template smoke suites, slowing workspace pipelines and discouraging adoption | Medium (2) | Medium (2) | 4 | Medium |
| SEC-001 | Security | Template omits `mcp-auth-kit` guard wiring or Express 5 middleware order, exposing new services to unauthenticated access or error leakage | Low (1) | High (3) | 3 | Low |

**Overall Story Risk Score:** 100 – (10 + 5 + 5 + 2) = 78 (Moderate). Closing TECH-001 first preserves the Express 5 alignment that underpins the epic.

## Detailed Risk Register

### TECH-001 – Template Dependency Drift
- **Drivers:** Manual copy of dependency versions/scripts from Stories 2.1/2.2 invites omissions (e.g., `@vitest/coverage-v8`, `npm run lint`). Express 4 transitive typings can reappear if the workspace reference isn’t pinned.
- **Mitigation:**
  - Diff `templates/service/package.json` against `services/mcp-test-server/package.json` and enforce parity tests.
  - Add CI guard (`npm ls express --workspaces`) in implementation and record evidence in the Dev Agent Record.
  - Mirror `tsconfig`/Vitest changes directly from the upgraded services to avoid reinventing config.
- **Residual Risk:** Low×Medium (score 2) after parity checks and evidence capture.

### OPS-001 – Bootstrap Validation Gaps
- **Drivers:** README/compose updates may lag behind script changes; engineers could skip `npm run postbump:test` without explicit bootstrap messaging.
- **Mitigation:**
  - Update `scripts/bootstrap.sh` output to enumerate lint/test/build/smoke/postbump steps and link to documentation shards.
  - Capture command transcript in Dev Notes; add follow-up if helper output reveals missing coverage.
  - Consider adding a lightweight smoke automation that fails when evidence artifacts are absent.
- **Residual Risk:** Low×Medium (score 2) once documentation and automation align.

### PERF-001 – Coverage Runtime Regression
- **Drivers:** V8 coverage with AST remapping can add seconds per workspace, particularly when scaffolds include Supertest integration suites.
- **Mitigation:**
  - Benchmark coverage runs on Node 22 and Node 24; document expected runtime in README.
  - Enable selective workspace flags and ensure coverage thresholds are right-sized for templates.
  - Monitor CI timing after rollout; fall back to `--reporter text-summary` if regressions exceed baseline tolerances.
- **Residual Risk:** Medium×Low (score 3) until benchmarks demonstrate acceptable performance.

### SEC-001 – Auth Guard Regression
- **Drivers:** Template might drop `mcp-auth-kit` middleware ordering or Express 5 async error handling, weakening authentication and error hygiene for new services.
- **Mitigation:**
  - Port the exact middleware stack from `services/mcp-test-server` and document required guard order.
  - Add integration test in template smoke suite verifying 401 challenges and sanitized error payloads.
  - Re-run smoke script after bootstrap to ensure guards remain active.
- **Residual Risk:** Low×Medium (score 2) once tests exist.

## Mitigation & Monitoring Plan
- Treat dependency parity as a pre-merge checklist item; fail PRs lacking `npm ls` output or `lint` script evidence.
- Propagate bootstrap guidance into architecture shards and enforce via code review checklist.
- Track Vitest runtime in CI dashboards after rollout; if coverage overhead persists, coordinate with DevOps for caching or reporter adjustments.
- Ensure security guard tests run in new scaffolds before first release.

Risk profile: qa.qaLocation/assessments/2.3-risk-20250924.md
