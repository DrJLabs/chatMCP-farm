# Risk Profile: Story 1.3

Date: 2025-09-22
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 0
- High Risks: 0
- Medium Risks: 3
- Low Risks: 2
- Risk Score: 85/100

Story 1.3 connects operational docs, smoke automation, and ChatGPT Developer Mode guidance. Automated guardrails now run `scripts/check-compose-profile.sh` (via `npm run guard`) to dry-run the opt-in compose profile and `scripts/check-inline-secrets.mjs` to prevent inline secrets or deprecated flags. Remaining risks focus on spec drift (Accept header + `Mcp-Session-Id`), keeping ChatGPT guidance current, and ensuring operators tear down the profile after validation.

## High Risks Requiring Immediate Attention

### 1. TECH-001: Compose profile misconfiguration destabilizes shared stack

**Score:** 3 (Low)

- **Probability:** Low — Guardrail runs `COMPOSE_PROFILES=mcp-test-server scripts/compose.sh --profile mcp-test-server config` during `npm test`, preventing accidental full-stack bring-up.
- **Impact:** High — Bringing the service up without isolation can block other services, but automation now detects missing profile usage before runtime.
- **Mitigation:** Keep guardrail script in CI, ensure external network defaults remain accurate. **Testing Focus:** Guard script plus documentation spot checks.

### 2. SEC-001: OAuth smoke workflow leaks bearer tokens or secrets

**Score:** 3 (Low)

- **Probability:** Low — `scripts/check-inline-secrets.mjs` fails the pipeline if inline secrets or the deprecated client-secret flag appear; `scripts/healthcheck.sh` now requires env-sourced credentials.
- **Impact:** High — Token exposure compromises the Keycloak realm, but automation blocks risky usage patterns.
- **Mitigation:** Maintain guard script, ensure operators continue to source `.keycloak-env`. **Testing Focus:** Guard script plus manual verification of secret sourcing guidance.

## Risk Distribution

### By Category

- Technical: 2 risks (0 high, 2 low)
- Security: 1 risk (0 high, 1 low)
- Operational: 1 risk (medium)
- Business: 1 risk (medium)
- Performance/Data: 0 risks

### By Component

- Documentation/runbook: 4 risks
- Automation scripts: 1 risk

## Detailed Risk Register

| Risk ID  | Category    | Description                                                                                                      | Probability | Impact | Score | Priority | Mitigation Highlights                                                                                               |
|----------|-------------|------------------------------------------------------------------------------------------------------------------|-------------|--------|-------|----------|---------------------------------------------------------------------------------------------------------------------|
| TECH-001 | Technical   | Compose profile instructions omit `COMPOSE_PROFILES` or network prerequisites, leading to unintended stack start. | Low (1)     | High (3) | 3   | Low      | Guardrail runs `scripts/check-compose-profile.sh` inside `npm test` to ensure opt-in profile usage; docs still call out prerequisites. |
| SEC-001  | Security    | Smoke workflow encourages inline tokens that persist in shell history or logs, risking credential leakage.       | Low (1)     | High (3) | 3   | Low      | Guardrail (`scripts/check-inline-secrets.mjs`) blocks inline secrets / deprecated flags; healthcheck requires env-sourced credentials. |
| TECH-002 | Technical   | Accept header / `Mcp-Session-Id` guidance drifts from MCP spec, reducing diagnostic value.                        | Medium (2)  | Medium (2) | 4 | Medium   | Anchor runbook instructions to spec revision 2025-06-18 and add regression assertions in smoke scripts.             |
| BUS-001  | Business    | ChatGPT Developer Mode instructions lag platform changes (e.g., `search`/`fetch` requirement), hurting adoption.  | Medium (2)  | Medium (2) | 4 | Medium   | Log follow-up triggers in runbook, note OpenAI guidance sources, and schedule regular validation checkpoints.       |
| OPS-001  | Operational | Operators enable profile but forget teardown, leaving service running and consuming resources.                    | Medium (2)  | Medium (2) | 4 | Medium   | Add post-run `scripts/compose.sh down --profile mcp-test-server` reminder and include in release checklist.         |

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests
- (No remaining high risks.) Guardrails now execute automatically; keep them in CI.

### Priority 2: Supporting High/Medium Risk Tests
- Regression test asserting Accept headers, `MCP-Protocol-Version`, and `Mcp-Session-Id` presence in smoke output.
- Documentation spot-check to confirm OpenAI references remain current each release.

### Priority 3: Medium/Low Risk Tests
- Checklist ensuring teardown commands are executed and docker networks cleaned up post-validation.
- Tabletop exercise verifying runbook steps for multi-operator handoff.

## Risk Acceptance Criteria

- **Must Fix Before Production:** None (guardrails automated).
- **Can Deploy with Mitigation:** TECH-002, BUS-001, OPS-001 (monitor per schedule).
- **Accepted Risks:** None at this time.

## Monitoring Requirements

- Track compose usage via CI logs to ensure profiles are respected.
- Audit shell history or security scanners for token leaks in operator environments.
- Maintain a calendar reminder to re-validate ChatGPT guidance quarterly.

## Risk Review Triggers

- Docker Compose profile behaviour changes or external network renames.
- OpenAI updates Developer Mode tooling requirements.
- Keycloak automation scripts change tokens or credential storage approach.

---

**Gate Summary Snippet**

```yaml
risk_summary:
  totals:
    critical: 0
    high: 0
    medium: 3
    low: 2
  highest:
    id: TECH-002
    score: 4
    title: Accept header/MCP metadata drift from spec
  recommendations:
    must_fix: []
    monitor:
      - Keep Accept header + MCP session guidance aligned with spec 2025-06-18
      - Schedule quarterly review of ChatGPT Developer Mode instructions
      - Re-run guardrails (`npm run guard`) in CI to ensure compose profile and secret checks stay active
```

**Trace Hook**

```
Risk profile: docs/qa/assessments/1.3-risk-20250922.md
```
