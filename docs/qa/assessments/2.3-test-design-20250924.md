# Test Design: Story 2.3 ‚Äì Refresh Service Template for Express 5 Baseline

Date: 2025-09-24  
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 7
- Unit tests: 2 (29%)
- Integration tests: 4 (57%)
- E2E tests: 1 (14%)
- Priority distribution: P0: 4, P1: 3, P2: 0, P3: 0

## Test Scenarios by Acceptance Criteria

### AC1: Template assets mirror Express 5 / Vitest 3 baseline with lint/test/build/smoke scripts and single Express tree

| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 2.3-UNIT-001 | Unit | P0 | Snapshot `templates/service/package.json` to enforce dependency versions, Node engines, and required scripts (`lint`, `test`, `build`, `smoke`) | Pure config verification; fast regression guard for TECH-001 |
| 2.3-INT-001 | Integration | P0 | `scripts/bootstrap.sh` ‚Üí `npm install` ‚Üí `npm ls express --workspace <scaffold>` to assert a single Express 5 tree and presence of coverage deps | Validates workspace dependency graph after scaffolding; mitigates Express 4 residue risk |
| 2.3-INT-004 | Integration | P1 | Run `npm run test -- --coverage` on scaffold, verify `coverage.provider` = `v8` with `coverage.experimentalAstAwareRemapping` enabled, and capture runtime/coverage diffs versus Vitest 3.2 guidance | Confirms V8 AST-aware remapping parity while tracking runtime to guard against PERF-001 regressions |

### AC2: Template docs/configs reference Express 5 baseline and `postbump:test` workflow

| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 2.3-UNIT-002 | Unit | P1 | Markdown assertion test ensuring template README / `.env.example` / `compose.yml` mention Express 5, `postbump:test`, rollback pointers, and security notes | Static content validation avoids doc drift and supports OPS-001 mitigations |

### AC3: Bootstrap flow succeeds (lint, test, build, smoke, postbump) on Node 22 with evidence capture

| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 2.3-INT-002 | Integration | P0 | Run `npm run lint|test|build|smoke --workspace <scaffold>` sequentially and collect artifacts for Dev Agent Record | Ensures generated service meets baseline tooling contracts |
| 2.3-E2E-001 | E2E | P1 | Execute `scripts/bootstrap.sh express5-demo` end-to-end on clean workspace, verifying CLI messaging prompts engineers to run postbump helper and store outputs | Validates full developer journey and documentation alignment |

### AC4: Story notes document sequencing with `mcp-auth-kit` and capture follow-ups on peer warnings

| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 2.3-INT-003 | Integration | P0 | Supertest suite against scaffolded service verifying `mcp-auth-kit` middleware enforces 401 challenge and sanitized error shape under Express 5 | Security-critical middleware integration; mitigates SEC-001 |

## Risk Coverage

- TECH-001 mitigated by 2.3-UNIT-001 and 2.3-INT-001.
- OPS-001 mitigated by 2.3-UNIT-002, 2.3-INT-002, and 2.3-E2E-001.
- PERF-001 mitigated by 2.3-INT-004.
- SEC-001 mitigated by 2.3-INT-003.

## Recommended Execution Order

1. 2.3-UNIT-001 (config snapshot) and 2.3-UNIT-002 (doc assertions) for immediate feedback.
2. 2.3-INT-001 (dependency graph) and 2.3-INT-002 (workspace commands) to confirm baseline tooling.
3. 2.3-INT-003 (auth guard) and 2.3-INT-004 (coverage runtime/remapping) for security/performance verification.
4. 2.3-E2E-001 (bootstrap UX) to validate full developer workflow and evidence capture.

Test design matrix: qa.qaLocation/assessments/2.3-test-design-20250924.md
P0 tests identified: 4

## üî¨ Research & Validation Log

- **2025-09-24 ‚Äì Vitest Coverage Alignment:** Confirmed Vitest 3.2 defaults to V8 coverage with AST-aware remapping; test design now requires verifying `coverage.experimentalAstAwareRemapping` to keep reports aligned with Istanbul accuracy while monitoring runtime. ÓàÄciteÓàÇturn0search0ÓàÇturn0search1ÓàÅ
- **2025-09-24 ‚Äì Express 5 Middleware Expectations:** Revalidated Express 5.1 requirement for Node 18+ and native async error handling; integration scenario 2.3-INT-003 remains focused on preserving auth guard ordering consistent with the 5.x migration guidance. ÓàÄciteÓàÇturn1search0ÓàÇturn1search1ÓàÅ
- **2025-09-24 ‚Äì Workspace Regression Workflow:** No newer guidance surfaced beyond existing `postbump:test` helper expectations; retained execution sequencing while capturing coverage and runtime metrics for evidence.
