# Risk Profile: Story 4.2

Date: 2025-09-25
Reviewer: Quinn (Test Architect)

## Executive Summary
- Total Risks Identified: 4
- Critical Risks: 0
- High Risks: 1
- Aggregate Risk Score: 15/100 (lower is better; sum of probability × impact × priority weighting)

## Critical Risks Requiring Immediate Attention
- None. Highest severity item is High (score 6) due to potential write access misconfiguration.

## Risk Matrix
| Risk ID      | Description                                                                    | Probability | Impact | Score | Priority |
|--------------|--------------------------------------------------------------------------------|-------------|--------|-------|----------|
| SEC-4.2-001  | `.env` overrides enable `ALLOW_WRITE`/`ENABLE_ROOTS` without review, exposing host paths. | Medium (2)  | High (3) | 6     | High     |
| OPS-4.2-001  | Compose profile fails when `/srv/projects` or `/srv/vaults` are absent on the host.      | Medium (2)  | Medium (2) | 4   | Medium   |
| OPS-4.2-002  | Traefik labels or `MCP_PUBLIC_HOST` mismatch causing SSE route outage.                  | Low (1)     | High (3) | 3     | Medium   |
| TECH-4.2-001 | Aggregated compose config drifts; scripts omit the new profile on `config`/`up`.        | Low (1)     | Medium (2) | 2   | Low      |

## Risk Distribution
- Security: 1 (0 critical, 1 high)
- Operational: 2 (0 critical, 0 high)
- Technical: 1 (0 critical, 0 high)
- Performance/Data/Business: 0 each

## Detailed Risk Register
### SEC-4.2-001 – Unsafe write toggles reach production
- **Category:** Security
- **Probability:** Medium – `.env.example` ships with safe defaults, but operators may copy and flip toggles while experimenting.
- **Impact:** High – When `ALLOW_WRITE=true` and roots enabled, filesystem clients can mutate host data.
- **Affected Components:** Compose profile, Traefik-exposed bridge, host mounts
- **Detection:** Configuration review, runtime audit logs, smoke harness verifying read-only behaviour
- **Mitigation Strategy:** Preventive/Detective
  - Keep `.env.example` defaults at `false` and document approval workflow in story/dev notes.
  - Add CI assertion that sample `.env` keeps toggles disabled.
  - Recommend runtime telemetry (`rust-mcp-filesystem` arguments) piped to logging stack.
- **Testing Requirements:**
  - Compose integration test flipping toggles ensures the container logs explicit warning banner.
  - Negative test verifying bridge refuses write operations when toggles remain false.
- **Residual Risk:** Medium – manual overrides still possible; requires ops change control.

### OPS-4.2-001 – Host mounts missing or misaligned
- **Category:** Operational
- **Probability:** Medium – Developers on macOS/WSL may not have `/srv/projects` or `/srv/vaults`.
- **Impact:** Medium – `docker compose up` aborts, blocking bridge availability.
- **Affected Components:** Host filesystem layout, compose volume bindings
- **Detection:** `compose up` logs, smoke script exit codes
- **Mitigation Strategy:** Preventive
  - Document prerequisite directories and mention overrides via `HOST_PROJECTS_ROOT` / `HOST_VAULTS_ROOT`.
  - Add preflight check in `scripts/compose.sh` (future enhancement) to validate host paths exist.
- **Testing Requirements:**
  - Integration test running compose with invalid path to confirm actionable error message.
  - Manual checklist entry before enabling profile on new hosts.
- **Residual Risk:** Medium – reliant on operator discipline until preflight shipped.

### OPS-4.2-002 – Routing gap due to label or hostname drift
- **Category:** Operational
- **Probability:** Low – Story reuses Traefik template, but mis-typed hostnames or unset env variables remain possible.
- **Impact:** High – SSE endpoint unreachable, breaking filesystem bridge access.
- **Affected Components:** Traefik labels, `proxy` network config, `.env` variables
- **Detection:** Traefik dashboard, `curl` against routed host, smoke script handshake
- **Mitigation Strategy:** Preventive/Detective
  - Leverage shared Traefik label snippets and include example `MCP_PUBLIC_HOST` in `.env.example`.
  - Extend smoke evidence to show routed host resolves successfully.
- **Testing Requirements:**
  - Compose bring-up verifying labels appear via `docker inspect`.
  - Runtime validation hitting `https://$MCP_PUBLIC_HOST` to confirm 200/SSE handshake.
- **Residual Risk:** Low – mitigated by deterministic labels and smoke tests.

### TECH-4.2-001 – Compose aggregation drifts or profile omitted
- **Category:** Technical
- **Probability:** Low – `scripts/compose.sh` already wires profile discovery, but regression possible if new path not added.
- **Impact:** Medium – `compose config` fails, or operators cannot enable profile.
- **Affected Components:** Compose tooling, automation scripts
- **Detection:** CI `compose config` validation, reviewer checklists
- **Mitigation Strategy:** Preventive
  - Update automation script tests to assert profile appears in rendered YAML.
  - Document in story to capture evidence (`scripts/compose.sh --profile filesystem-mcp config`).
- **Testing Requirements:**
  - Add regression test in compose automation verifying profile enumerated.
  - Monitor CLI output for warnings about unknown profiles.
- **Residual Risk:** Low – strong coverage once automation evidence captured.

## Risk-Based Testing Strategy
- **Priority 0:** Security toggles (SEC-4.2-001) – ensure tests assert defaults remain read-only and log warnings when overrides applied.
- **Priority 1:** Mount validation (OPS-4.2-001) – negative path tests verifying clear error messaging.
- **Priority 2:** Routing and aggregation (OPS-4.2-002, TECH-4.2-001) – inspect Traefik labels, confirm profile appears in `compose config` output.

## Risk Acceptance Criteria
- **Must Resolve Before Release:** SEC-4.2-001 guardrails and documentation must exist; no go-live until approvals for write access documented.
- **Mitigated for Release:** OPS-4.2-001 and OPS-4.2-002 acceptable with documented runbooks and smoke coverage.
- **Accepted Risks:** TECH-4.2-001 acceptable once automation evidence collected; monitor compose script PRs for regressions.

## Monitoring Requirements
- Capture container start arguments via logs to detect write/roots toggles.
- Alert on Traefik 5xx/4xx for `filesystem-mcp` routers.
- Track compose automation job failures related to profile rendering.

## Risk Review Triggers
- Operators request write access or additional mount roots.
- Compose tooling refactored (scripts/compose.sh rewrite or new aggregator).
- Traefik routing templates change or TLS termination moves upstream.

## Recommendations
1. Add CI check to parse `.env.example` ensuring toggles remain false.
2. Extend smoke script to capture Traefik route health and host mount verification.
3. Document host path override procedure clearly in Dev Notes/runbooks.
4. Schedule follow-up once write access feature entered pilot to reassess security posture.

```text
Risk profile stored at qa.qaLocation/assessments/4.2-risk-20250925.md
```
